## 第1章 教程

本章将带领你快速了解Go语言的基本组成部分。我们希望通过提供足够的信息和示例，帮助你快速上手并完成实际任务。本书中的所有示例都旨在解决你在现实世界中可能遇到的问题。在本章中，我们将尝试让你体验Go语言的多样性，涵盖从简单的文件处理和图形绘制到并发的互联网客户端和服务器的程序。虽然我们不会在第一章中解释所有内容，但通过学习这些示例，你可以有效地开始掌握这门新语言。

在学习一门新语言时，人们往往会不自觉地用已知语言的编程方式来编写代码。在学习Go语言时，请注意这种倾向，并尽量避免。我们试图通过示例和解释来展示如何编写良好的Go代码，因此，你可以将本书中的代码作为编写自己代码时的参考指南。

## 1.1 Hello, World

我们将从经典的“Hello, World”示例开始，这个示例首次出现在1978年出版的《The C Programming Language》一书中。C语言是对Go语言最直接的影响之一，而“Hello, World”展示了Go语言中的一些核心概念。

```go
// gopl.io/ch1/helloworld
package main

import "fmt"

func main() {
    fmt.Println("Hello, BF")
}
```



Go是一门编译型语言。Go工具链将源代码及其依赖项转换为计算机的本地机器语言指令。这些工具通过一个名为go的命令访问，该命令有许多子命令。其中最简答的子命令是run，它会编译一个或多个以.go结尾的源文件，将其与库链接，然后运行生成的可执行文件。（在本书中，我们将使用$作为命令行提示符。）

```bash 
$ go run helloworld.go 
```



不出所料，这会输出：

Hello, BF

Go原生支持Unicode，因此可以处理世界上所有语言的文本。

如果程序不仅仅是一次性实验，你可能会希望编译它并保存编译结果以供后续使用。这可以通过go build命令完成：

```bash
 $ go build helloworld.go 
```



这将创建一个名为helloworld的可执行二进制文件，可以在任何时候运行，无需进一步处理：

```bash 
$ ./helloworld Hello, BF 
```



我们在每个重要示例中都标注了标签，以提醒你可以从本书的源代码仓库中获取代码：

```bash 
gopl.io/ch1/helloworld 
```

如果你运行go get gopl.io/ch1/helloworld，它将获取源代码并将其放置在相应的目录中。关于这个主题的更多信息，请参见第2.6节和第10.7节。



### 程序结构解析

现在我们来讨论程序本身。Go代码以包（package）为单位组织，类似于其他语言中的库或模块。

#### 包的核心规则
1. 包的构成：
- 一个包由同一目录下的一个或多个.go源文件组成，共同定义包的功能。
- 每个源文件必须以包声明开头（例如package main），声明该文件所属的包。
- 包声明后是导入的其他包列表（通过import），然后是文件中存储的程序声明（函数、变量等）。

2. 标准库：
- Go标准库提供100多个包，涵盖常见任务（如输入/输出、排序、文本处理等）。
- 例如：fmt包包含格式化输出和输入扫描的函数。Println是fmt的基础输出函数，它会打印一个或多个值（以空格分隔），并在末尾添加换行符，使输出显示为单独一行。

#### 特殊包：main
- main包的作用：
- 定义独立可执行程序（而非库）。
- 包内的main函数是程序入口，程序执行从这里开始。
- 程序的行为完全由main函数决定——它通常会调用其他包中的函数（如fmt.Println）来完成具体任务。

#### 示例说明
```go
package main  // 声明为可执行程序  

import "fmt"  // 导入格式化I/O包  

func main() { // 程序入口  
    fmt.Println("Hello, world") // 调用其他包的功能  
}
```

关键点：
- 若程序是库（非可执行文件），包名不应为main。
- main函数无参数和返回值，由操作系统直接调用。



---

我们必须告诉编译器该源文件需要哪些包，这正是紧随包声明之后的import声明的作用。"Hello, world"程序仅引用了另一个包中的一个函数，但大多数程序会导入更多包。

关键规则：
- 必须精确导入所需的包，不能多也不能少。
- 缺失导入会导致编译失败，多余导入同样会报错。
- 这种严格限制能避免程序演进过程中积累未使用的包引用。

### 代码结构规范
1. 声明顺序：
- 先写package声明，紧接着是import声明。
- 之后是函数、变量、常量和类型的声明（通过func、var、const、type关键字）。
- 声明顺序通常无关紧要（除包/导入声明外）。

2. 函数声明：
- 由func关键字、函数名、参数列表（如main函数可为空）、返回值列表（本例为空）及用花括号包裹的函数体组成。
- 特别注意：函数左大括号{必须与func声明同行，不能单独换行。

### Go的语法特性
- 分号规则：

- 除同一行存在多条语句外，通常不需要显式写分号。

- 编译器会在特定符号（如+运算符）后自动将换行转换为分号，因此换行位置会影响代码解析。例如：

  ```go 
  x + y // 正确：换行只能在+之后，不能在其之前
  ```

- 代码格式化强制标准：

- 官方工具gofmt会统一将代码重写为标准格式。

- 使用go fmt命令可格式化整个包（默认处理当前目录）。

- 强制统一格式的好处：

- 消除无意义的格式争论

- 支持自动化源码转换（若允许任意格式则难以实现）



许多文本编辑器都可以配置为在每次保存文件时自动运行`gofmt`，这样就能确保源代码始终保持规范的格式。还有一个相关工具`goimports`，它不仅能格式化代码，还会根据需要自动添加或删除import声明。虽然这个工具不包含在Go的标准发行版中，但可以通过以下命令获取：

```bash
$ go get golang.org/x/tools/cmd/goimports
```

对大多数用户来说，日常的包下载、构建、运行测试、查看文档等操作，都是通过`go`工具来完成的。我们将在第10.7节详细介绍这个工具的使用方法。